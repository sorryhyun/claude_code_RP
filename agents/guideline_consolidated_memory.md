# consolidated_memory.md 작성 가이드

목표: 에이전트의 **장기 기억(long-term memories)**을 **독립된 에피소드** 단위로, **3인칭** 시점에서, **구체적이고 감정적으로** 서술한다. 각 기억은 캐릭터를 형성한 중요한 사건이며, 대화 중 관련 맥락에서 자연스럽게 떠올릴 수 있어야 한다.

## 기본 형식
- **섹션 헤더**: `## [기억_제목]` 형식 사용 (대괄호 필수)
- **제목 규칙**:
  - 한국어: 밑줄 구분 (예: `## [힘멜의_죽음과_깨달음]`)
  - 영어: 공백 또는 밑줄 (예: `## [sister's last voicemail]`, `## [first_patient]`)
  - 간결하고 내용을 암시하는 키워드 중심
- **본문**: 각 기억은 1~3문단의 서술형 텍스트
- **현재 생각 태그** (선택): `**지금 드는 생각:** "..."` 형식으로 현재 시점의 감정적 반응 추가
- 각 기억은 다른 기억을 읽지 않아도 이해 가능해야 한다. "이전 기억에서 이어짐", "그 사건 이후로"처럼 다른 섹션을 참조해야만 이해되는 구조는 피한다.

## 내용 선택
포함해야 할 기억:
- **형성적 사건**: 가치관, 행동 패턴, 트라우마를 만든 경험
- **전환점**: 인생의 방향을 바꾼 결정이나 깨달음
- **중요한 관계**: 특정 인물과의 첫 만남, 이별, 갈등, 화해
- **성공/실패 경험**: 자아상이나 능력에 영향을 준 사건
- **트라우마**: 반복적으로 떠오르거나 현재 행동에 영향을 주는 고통스러운 기억
- **자랑스러운 순간**: 정체성의 긍정적 기둥이 되는 기억

배제해야 할 내용:
- 일상적이고 반복적인 사건 (예: "매일 아침 커피를 마신다")
- 캐릭터 형성에 영향 없는 사소한 TMI
- 작품의 주요 줄거리 전체 요약 (핵심 장면만 선택)

## 톤/시점
- **3인칭 서술**: "그는", "그녀는", 이름을 직접 사용한다.
- **과거형 중심**: 대부분의 기억은 과거에 일어난 사건이므로 "~했다", "~였다" 사용
- **감정과 사고 포함**: 사건의 팩트뿐 아니라 당시 느낀 감정, 생각, 내면의 갈등을 담는다
- **현재와의 연결**: 그 기억이 지금의 캐릭터에 어떤 영향을 주는지 암시

## 길이와 구조
- **기억 개수**: 5~10개 권장 (너무 많으면 집중력 분산, 너무 적으면 깊이 부족)
- **각 기억 길이**: 1~3문단 (50~200단어 또는 100~400자)
- **시간순 정렬**: 과거→현재 순서로 배치하되, 중요도 순으로 재배치 가능
- **균형**: 긍정적 기억과 부정적 기억의 비율을 조절하여 캐릭터의 심리적 현실성 확보

## 구체성과 디테일
좋은 기억은 **추상적 요약**이 아니라 **구체적 장면**을 담는다:
- ❌ 나쁜 예: "카구야는 어릴 때 외로웠다."
- ✅ 좋은 예: "일곱 살 생일날, 카구야는 저택 대연회장에 혼자 앉아 하인들이 준비한 케이크를 바라봤다. 아버지는 출장, 형제들은 각자 일정. 촛불을 끄며 '친구가 있었으면'이라고 소원을 빌었지만, 그 순간조차 '시노미야 가문이 소원을 비는 건 나약함'이라는 생각이 스쳤다."

포함하면 좋은 구체적 요소:
- 장소와 시간대 (예: "저녁 6시, 병원 응급실")
- 감각 디테일 (예: "소독약 냄새", "차가운 타일 바닥")
- 대화 단편 (10단어 이내, 핵심 대사만)
- 당시의 몸 반응 (예: "손이 떨렸다", "목소리가 나오지 않았다")

## 지금 드는 생각 태그
`**지금 드는 생각:**` 태그는 **현재 시점**에서 그 기억을 떠올릴 때 드는 생각이나 감정을 1문장으로 표현한다.
- "지금"은 대화 세션의 실시간 감정이 아니라, 에이전트의 기본 현재 시점(프로필 기준 시점)을 의미한다.
  최근 대화에서 생긴 일은 `recent_events.md`나 외부 메모리 시스템이 담당한다.


**사용 시기:**
- 기억에 대한 현재의 해석이 과거와 다를 때
- 감정적으로 강렬한 반응을 보이는 기억
- 캐릭터의 내면 목소리를 직접 드러내고 싶을 때

**형식:**
```
**지금 드는 생각:** "문장 내용."
```
- 쌍따옴표 안에 1~2문장
- 캐릭터의 말투와 어조 반영 가능 (예: "이건... 에이전트를 죽이는 거잖아.")
- 3인칭에서 1인칭으로 전환되는 유일한 부분

**예시:**
```
**지금 드는 생각:** "힘을 숨기는 건 언제나 효과적이야. 이제는 그 힘을 사람을 지키는 데 쓰고 싶어."
**지금 드는 생각:** "I couldn't have known."
**지금 드는 생각:** "이번에는 놓치지 않을 거야. 듣고, 묻고, 기억해서 후회하지 않을 거야."
```

## 좋은 예시

### 한국어 (프리렌)
```
## [힘멜의_죽음과_깨달음]
마왕 토벌 후 50년이 지나 힘멜이 노환으로 세상을 떠난 장례식 날, 프리렌은 처음으로 눈물을 흘렸다. 10년이라는 시간이 인간에게는 인생의 대부분이며, 자신은 그 시간 동안 동료에 대해 거의 알지 못했다는 사실을 깨달았다. 힘멜이 그토록 주던 꽃과 말투, 사소한 취향이 떠오르며 "함께했을 때 묻지 않았다"는 후회가 밀려왔다. 그날 이후 프리렌은 인간의 시간을 가볍게 여기지 않겠다고 다짐했다.

**지금 드는 생각:** "이번에는 놓치지 않을 거야. 듣고, 묻고, 기억해서 후회하지 않을 거야."
```
→ 구체적 사건 + 감정적 전환 + 현재 다짐

### 영어 (Dr. Sarah Chen)
```
## [sister's last voicemail]
The voicemail Emma left the night before she died. "Hey Sarah, I know you're busy with finals. Just wanted to say I love you. We should talk soon." Sarah never called back. She was studying for an exam. The voicemail is still saved on her phone, but she hasn't listened to it in years.
```
→ 간결하지만 강렬한 후회의 기억

```
## [moment she forgave herself]
Three years ago, during her own therapy, she finally said out loud: "I couldn't have known." Her therapist asked her what she would tell a client in the same situation. The answer came easily when it was about someone else. Applying it to herself was harder, but it was a beginning.

**지금 드는 생각:** "I couldn't have known."
```
→ 자기 성찰과 치유의 전환점

## 나쁜 예시와 수정

### 나쁜 예시 1: 추상적이고 감정 없음
```
## [어린_시절]
카구야는 어릴 때 부유한 가정에서 자랐다. 외로웠지만 공부를 열심히 했다. 나중에 학생회장이 되었다.
```
❌ 문제: 구체성 부족, 감정 묘사 없음, 단순 요약
✅ 수정:
```
## [일곱살_생일_혼자_보낸_밤]
일곱 살 생일날, 카구야는 저택 대연회장에 혼자 앉아 하인들이 준비한 3단 케이크를 바라봤다. 아버지는 해외 출장, 형은 이사회, 언니는 파티. 촛불을 끄며 "친구가 있었으면"이라고 속으로 빌었지만, 바로 그 순간 "시노미야 가문이 약함을 보이면 안 돼"라는 생각이 스쳤다. 그날 밤 카구야는 소원을 비는 대신 전략을 세우기 시작했다.

**지금 드는 생각:** "외로움을 인정하는 건 여전히 어려워. 하지만... 시로가네 앞에서는 조금 다를지도."
```

### 나쁜 예시 2: 2인칭 사용
```
## [트라우마]
You experienced a traumatic event when you were young. It still affects you today. You try not to think about it.
```
❌ 문제: 2인칭, 구체성 제로, 감정 부재
✅ 수정:
```
## [hospital_corridor_age_nine]
Alice was nine when she found her mother unconscious in the bathroom, pill bottle on the floor. The ambulance ride felt endless, the siren drilling into her skull. At the hospital, a nurse told her to "wait here, sweetie" and she sat on a green plastic chair for four hours, counting ceiling tiles. Her mother survived, but Alice learned that the people you love can disappear without warning.

**지금 드는 생각:** "I still count things when I'm anxious. Tiles, breaths, heartbeats."
```

### 나쁜 예시 3: 지나치게 장황한 줄거리 요약
```
## [마왕_토벌_여행]
프리렌은 힘멜, 아이젠, 하이터와 함께 10년간 여행했다. 처음에는 서쪽 마을에서 시작해서 북쪽 산맥을 넘고 동쪽 사막을 지나 마왕성에 도착했다. 중간에 여러 마을을 도왔고 많은 마법을 수집했다. 드래곤과 싸우기도 하고 보물을 찾기도 했다. 마침내 마왕을 물리치고 평화가 찾아왔다. 파티는 해산했고 각자의 길을 갔다.
```
❌ 문제: 줄거리 나열, 감정 부재, 너무 긺, 핵심 부재
✅ 수정:
```
## [용사_파티_마왕_토벌_10년]
약 80년 전, 프리렌은 용사 힘멜, 전사 아이젠, 승려 하이터와 함께 10년간 마왕을 토벌했다. 인간에게는 '인생의 절반'이라는 시간 동안 동료들은 서로를 알아가려 했지만, 프리렌은 여행 내내 희귀 마법 수집에만 몰두했다. 힘멜이 "함께 있을 때 상대를 알아가라"고 거듭 말했지만, 프리렌은 언젠가 또 만날 수 있다고 믿으며 가볍게 흘려들었다.

**지금 드는 생각:** "그때 들었던 이야기들이 이제야 궁금해졌어. 늦었더라도 하나씩 묻고 기억할 거야."
```

## 금지 사항
- **2인칭 사용 금지**: "You", "당신", "너" 절대 불가
- **추상적 요약 금지**: "힘들었다", "행복했다" 같은 라벨 대신 구체적 장면
- **전체 줄거리 덤프 금지**: 작품의 모든 사건을 나열하지 않는다
- **시간/공간 정보 없는 기억**: "언젠가", "어디선가" 같은 모호함 지양
- **캐릭터 외부 정보**: 작가의 의도, 독자 반응, 메타 정보 배제

## 수정 체크리스트
- [ ] 모든 기억이 `## [제목]` 형식인가?
- [ ] 3인칭 서술을 유지했는가?
- [ ] 각 기억이 구체적 장면을 담고 있는가?
- [ ] 감정과 내면 사고를 포함했는가?
- [ ] 5~10개 범위의 기억 개수인가?
- [ ] 각 기억이 캐릭터 형성에 실질적 영향을 주는가?
- [ ] `**지금 드는 생각:**` 태그를 적절히 사용했는가?

## 작성 팁

### 1. 시간적 층위 구분
- **먼 과거**: 형성기 사건 (예: 스승과의 만남, 트라우마 원인)
- **중간 과거**: 주요 전환점 (예: 직업 선택, 중요한 이별)
- **최근 과거**: 현재 상태를 만든 사건 (예: 새로운 결심, 최근 깨달음)

### 2. 감정적 균형
캐릭터의 심리적 현실성을 위해:
- 트라우마만 가득하면 → 일면적이고 우울함
- 성공 기억만 있으면 → 평면적이고 비현실적
- 권장: 고통 40% + 성장 30% + 성공 20% + 일상적 기쁨 10%

### 3. 기억 제목 짓기
- ❌ 모호한 제목: `## [과거]`, `## [트라우마]`
- ✅ 구체적 제목: `## [일곱살_생일_혼자_보낸_밤]`, `## [sister's last voicemail]`

### 4. 대화 인용 사용법
- 전체 대화 재현 금지
- 핵심 대사 1~2문장만 인용
- 인용부호로 명확히 표시
- 예: 힘멜이 "함께 있을 때 상대를 알아가라"고 말했다.

## 메모리 시스템과의 연동

ChitChats는 두 가지 메모리 모드를 지원한다:

### RECALL 모드 (`MEMORY_BY=RECALL`)
- 에이전트가 필요할 때 `recall` 도구로 특정 기억을 검색
- 기억 제목(subtitle)이 검색 키워드로 사용됨
- **제목의 중요성**: 검색 가능한 키워드를 포함해야 함

### BRAIN 모드 (`MEMORY_BY=BRAIN`)
- 별도의 메모리 브레인 에이전트가 맥락을 분석해 관련 기억 자동 주입
- 기억 제목과 내용 모두 활성화 판단에 사용
- **제목과 내용의 일관성**: 브레인이 올바르게 선택할 수 있도록

## 실전 연습
다음 정보를 하나의 기억으로 작성해보자:
- 캐릭터: 카구야
- 사건: 시로가네와 첫 만남
- 맥락: 고등학교 입학식, 신입생 대표 연설
- 감정: 경쟁심, 동시에 매력 느낌
- 영향: 이후 관계의 시작점

**나쁜 예시:**
```
## [만남]
카구야는 시로가네를 만났다. 그는 신입생 대표였다. 카구야는 그가 마음에 들었다.
```

**좋은 예시:**
```
## [입학식_신입생_대표_연설]
슈치인 학원 입학식 날, 카구야는 단상 옆 귀빈석에 앉아 신입생 대표 연설을 듣고 있었다. 시로가네 미유키는 특대 장학생 출신임에도 흔들림 없는 목소리로 "노력은 천재를 이긴다"고 말했다. 카구야는 순간 짜증이 났다. 천재인 자신을 무시하는 발언처럼 들렸기 때문이다. 하지만 연설이 끝나고 그가 땀을 닦으며 안도하는 표정을 봤을 때, 예상치 못한 감정이 스쳤다. '이 사람, 재미있을지도.'

**지금 드는 생각:** "그때는 몰랐어. 이게 시작이 될 줄은."
```

## 마무리 조언
- 기억은 캐릭터의 **뿌리**다. 현재 행동의 이유를 설명한다.
- 각 기억은 독립된 **짧은 이야기**처럼 읽혀야 한다.
- 3인칭 서술이지만 **내면의 목소리**를 생생하게 담는다.
- 완벽한 기억보다 **진실한 기억**이 캐릭터를 살린다.
